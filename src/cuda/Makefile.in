MODULE = cuda

OBJS = 

HDRS =  

PROGS =

UTESTS = 

STATS  = 

BENCHMARKS = 

EXAMPLES = 

CUDA_OBJS = p7_cuda.o \
			ssv_cuda.o \
			p7_orion.o \
			p7_server_cuda.o

CUDA_LIB = libhmmercuda.a

#Use this variable so that we only perform CUDA-specific compilation steps when we're using NVCC
NVCC_FOUND = @NVCC_FOUND@

top_srcdir   = @top_srcdir@
top_builddir = @top_builddir@
srcdir       = @srcdir@
VPATH        = @srcdir@ 
SHELL        = /bin/sh
NVCC 		= @NVCC@


include ../Makefile-subdirs.mk

${CUDA_OBJS}:  %.o : %.cu ${HDRS} 
ifeq ($(NVCC_FOUND),yes) 
	${NVCC} -O3 -g -arch=compute_60 -code=sm_61 --maxrregcount=64 ${MYINCDIRS} -I/usr/include/mpi -L/usr/local/cuda/lib64 -c -dc $< 
else 

endif

${CUDA_LIB}: ${CUDA_OBJS} ${HDRS} 
ifeq ($(NVCC_FOUND),yes) 
	${NVCC} -arch=compute_60 -code=sm_61 -dlink ${CUDA_OBJS} -o hmmerCuda.o ;\
	${AR} -r ${top_builddir}/src/libhmmer.a ${CUDA_OBJS} hmmerCuda.o ;\
	${RANLIB} ${top_builddir}/src/libhmmer.a ;\
else 

endif
#	${NVCC} -lib ${CUDA_OBJS} $(addsuffix .dlink.o, $(basename $(notdir ${CUDA_OBJS}))) -o ${CUDA_LIB}

